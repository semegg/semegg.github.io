<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/html">

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu</title>
</head>

<body>
<div class="wrapper">
    <div class="container">
        <div class="inner">
            <div class="lin">
                <div class="item" id="amrcn">
                    <div class="counter">0</div>
                    <img src="coffee_pics/amrcn.png" alt="" class="img">
                    <p class="usercard">amrcn • <strong>30₴</strong></p>
                <div class="table">
                    <div class="row">
                        <div class="btn cell minus" id="remove_amrcn">-</div>
                        <div class="cell"></div>
                        <div class="btn cell plus" id="btn_amrcn">+</div>
                    </div>
                </div>
                <button class="btn add" id="btn_amrcn">ADD</button>
                </div>
                

                <div class="lin">
                    <div class="item" id="dpp">
                        <div class="counter">0</div>
                        <img src="coffee_pics/dpp.png" alt="" class="img">
                        <p class="usercard">dpp • <strong>30₴</strong></p>
                    <div class="table">
                        <div class="row">
                            <div class="btn cell minus" id="remove_dpp">-</div>
                            <div class="cell"></div>
                            <div class="btn cell plus" id="btn_dpp">+</div>
                        </div>
                    </div>
                    <button class="btn add" id="btn_dpp">ADD</button>
                    </div>
                </div>
            </div>
        </div>
    </div>  
</div>



<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script>
  // Код з buttons.js
  const items_btn = document.body.getElementsByClassName("item");

  for (let item of Array.from(items_btn)) {
    const counter = item.getElementsByClassName("counter")[0];
    counter.style.setProperty("visibility", "hidden");

    const table = item.getElementsByClassName("table")[0];
    table.style.setProperty("display", "none");
    const row = table.getElementsByClassName("row")[0];

    const inc = row.getElementsByClassName("plus")[0];
    inc.addEventListener("click", () => increment(item));

    const dec = row.getElementsByClassName("minus")[0];
    dec.addEventListener("click", () => decrement(item));

    const add = item.getElementsByClassName("add")[0];
    add.addEventListener("click", () => increment(item));

    const initialValue = localStorage.getItem(`counter_${item.id}`);

    if (initialValue > 0) {
      counter.style.setProperty("visibility", "visible");
      counter.textContent = Number(initialValue);
      item.getElementsByClassName("table")[0].style.setProperty("display", "block");
      item.getElementsByClassName("add")[0].style.setProperty("display", "none");
    }
  }

  const increment = (item) => {
    const counter = item.getElementsByClassName("counter")[0];
    let value = Number(counter.textContent);

    if (!value) {
      counter.style.setProperty("visibility", "visible");
      item.getElementsByClassName("table")[0].style.setProperty("display", "block");
      item.getElementsByClassName("add")[0].style.setProperty("display", "none");
    }

    value += 1;
    counter.textContent = value;
    localStorage.setItem(`counter_${item.id}`, value);
  };

  const decrement = (item) => {
    const counter = item.getElementsByClassName("counter")[0];
    let value = Number(counter.textContent);

    if (!(value - 1)) {
      counter.style.setProperty("visibility", "hidden");
      item.getElementsByClassName("table")[0].style.setProperty("display", "none");
      item.getElementsByClassName("add")[0].style.setProperty("display", "block");
    }

    value -= 1;
    counter.textContent = value;
    localStorage.setItem(`counter_${item.id}`, value);
  };


  // Код з web_app.js
  let tg = window.Telegram.WebApp;
  tg.expand();
  tg.MainButton.textColor = "#FFFFFF";
  tg.MainButton.color = "#2cab37";

  let items = [];

  const savedItems = localStorage.getItem("items");
  if (savedItems) {
    items = JSON.parse(savedItems);
    if (window.location.pathname === "/") {
      tg.MainButton.setText("Continue");
    } else {
      const count = items.length;
      tg.MainButton.setText(`Вы выбрали ${count} товаров!`);
    }
    tg.MainButton.show();
  }

  let buttons = document.querySelectorAll('[id^="btn_"]');
  buttons.forEach((button) => {
    button.addEventListener("click", function () {
      const buttonId = button.id.slice(4);
      items.push(buttonId);
      const count = items.length;
      tg.MainButton.setText(`Вы выбрали ${count} товаров!`);
      tg.MainButton.show();
    });
  });

  Telegram.WebApp.onEvent("mainButtonClicked", function () {
    if (window.location.pathname === "/menu.html") {
      localStorage.setItem("items", JSON.stringify(items));
      window.location.href = "/";
    } else if (window.location.pathname === "/") {
      tg.sendData(savedItems);
      localStorage.clear();
      window.close();
    }
  });
</script>

</body>

</html>